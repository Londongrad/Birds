<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:helpers="clr-namespace:Birds.UI.Views.Helpers">

    <!-- ========================================================== -->
    <!-- Empty template: disables any red border on containers -->
    <!-- ========================================================== -->
    <ControlTemplate x:Key="NoErrorTemplate">
        <AdornedElementPlaceholder />
    </ControlTemplate>

    <!-- =================================================================== -->
    <!-- Universal template where error placement is controlled via an attached property -->
    <!-- =================================================================== -->
    <ControlTemplate x:Key="FieldErrorTemplate_Universal">
        <DockPanel>

            <!-- =========== -->
            <!-- The adorned element that contains the validation error -->
            <!-- =========== -->
            <AdornedElementPlaceholder
                x:Name="adorner"
                DockPanel.Dock="Left" />

            <!-- ============================ -->
            <!-- Validation error message text -->
            <!-- ============================ -->
            <!--
                Defines the maximum width of the validation message text.
                The binding is performed using the attached property
                helpers:ValidationPlacement.MaxErrorWidth,
                which can be set directly on the control (e.g., DatePicker or TextBox).

                Example usage:
                <DatePicker helpers:ValidationPlacement.MaxErrorWidth="180" />

                If not specified, the default value (270 pixels) is used.
            -->
            <ItemsControl
                x:Name="errors"
                Margin="0,0,0,0"
                VerticalAlignment="Center"
                ItemsSource="{Binding ElementName=adorner,
                                      Path=AdornedElement.(Validation.Errors)}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock
                            MaxWidth="{Binding ElementName=adorner,
                                               Path=AdornedElement.(helpers:ValidationPlacement.MaxErrorWidth)}"
                            FontSize="14"
                            Foreground="Red"
                            Text="{Binding ErrorContent}"
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="Wrap" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </DockPanel>

        <ControlTemplate.Triggers>

            <!-- ===================================================== -->
            <!-- Global trigger: hides errors when HasError = false -->
            <!-- ===================================================== -->
            <DataTrigger
                Binding="{Binding ElementName=adorner,
                                  Path=AdornedElement.(Validation.HasError)}"
                Value="False">
                <Setter TargetName="errors" Property="Visibility" Value="Collapsed" />
            </DataTrigger>

            <!-- ================================ -->
            <!-- Changing DockPanel layout dynamically -->
            <!-- ================================ -->
            <!-- ============= -->
            <!-- Errors on the right -->
            <!-- ============= -->
            <DataTrigger
                Binding="{Binding ElementName=adorner,
                                  Path=AdornedElement.(helpers:ValidationPlacement.Dock)}"
                Value="Right">
                <Setter TargetName="adorner" Property="DockPanel.Dock" Value="Left" />
                <Setter TargetName="errors" Property="DockPanel.Dock" Value="Right" />
                <Setter TargetName="errors" Property="Margin" Value="8,0,0,0" />
            </DataTrigger>

            <!-- ============ -->
            <!-- Errors on the left -->
            <!-- ============ -->
            <DataTrigger
                Binding="{Binding ElementName=adorner,
                                  Path=AdornedElement.(helpers:ValidationPlacement.Dock)}"
                Value="Left">
                <Setter TargetName="adorner" Property="DockPanel.Dock" Value="Right" />
                <Setter TargetName="errors" Property="DockPanel.Dock" Value="Left" />
                <Setter TargetName="errors" Property="Margin" Value="0,0,8,0" />
            </DataTrigger>

            <!-- ============ -->
            <!-- Errors at the bottom -->
            <!-- ============ -->
            <DataTrigger
                Binding="{Binding ElementName=adorner,
                                  Path=AdornedElement.(helpers:ValidationPlacement.Dock)}"
                Value="Bottom">
                <Setter TargetName="adorner" Property="DockPanel.Dock" Value="Top" />
                <Setter TargetName="errors" Property="DockPanel.Dock" Value="Bottom" />
                <Setter TargetName="errors" Property="Margin" Value="0,4,0,0" />
            </DataTrigger>

            <!-- ============= -->
            <!-- Errors at the top -->
            <!-- ============= -->
            <DataTrigger
                Binding="{Binding ElementName=adorner,
                                  Path=AdornedElement.(helpers:ValidationPlacement.Dock)}"
                Value="Top">
                <Setter TargetName="adorner" Property="DockPanel.Dock" Value="Bottom" />
                <Setter TargetName="errors" Property="DockPanel.Dock" Value="Top" />
                <Setter TargetName="errors" Property="Margin" Value="0,0,0,4" />
            </DataTrigger>

        </ControlTemplate.Triggers>
    </ControlTemplate>


    <!-- ====================================================================================== -->
    <!-- Apply the empty ErrorTemplate globally to remove the red control border -->
    <!-- ====================================================================================== -->
    <Style TargetType="Panel">
        <Setter Property="Validation.ErrorTemplate" Value="{StaticResource NoErrorTemplate}" />
    </Style>

    <Style TargetType="Border">
        <Setter Property="Validation.ErrorTemplate" Value="{StaticResource NoErrorTemplate}" />
    </Style>

    <Style TargetType="UserControl">
        <Setter Property="Validation.ErrorTemplate" Value="{StaticResource NoErrorTemplate}" />
    </Style>

    <Style TargetType="Window">
        <Setter Property="Validation.ErrorTemplate" Value="{StaticResource NoErrorTemplate}" />
    </Style>

    <Style TargetType="ContentControl">
        <Setter Property="Validation.ErrorTemplate" Value="{StaticResource NoErrorTemplate}" />
    </Style>

    <Style TargetType="ContentPresenter">
        <Setter Property="Validation.ErrorTemplate" Value="{StaticResource NoErrorTemplate}" />
    </Style>

    <Style TargetType="Grid">
        <!-- Important: bind dynamically to support runtime resource changes -->
        <Setter Property="Validation.ErrorTemplate" Value="{DynamicResource NoErrorTemplate}" />
    </Style>
</ResourceDictionary>